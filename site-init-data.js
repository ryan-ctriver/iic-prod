(()=>{var T=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],S=1,g=8,b=class n{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[e,i]=new Uint8Array(t,0,2);if(e!==219)throw new Error("Data does not appear to be in a KDBush format.");let s=i>>4;if(s!==S)throw new Error(`Got v${s} data when expected v${S}.`);let r=T[i&15];if(!r)throw new Error("Unrecognized array type.");let[u]=new Uint16Array(t,2,1),[d]=new Uint32Array(t,4,1);return new n(d,u,r,t)}constructor(t,e=64,i=Float64Array,s){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let r=T.indexOf(this.ArrayType),u=t*2*this.ArrayType.BYTES_PER_ELEMENT,d=t*this.IndexArrayType.BYTES_PER_ELEMENT,o=(8-d%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${i}.`);s&&s instanceof ArrayBuffer?(this.data=s,this.ids=new this.IndexArrayType(this.data,g,t),this.coords=new this.ArrayType(this.data,g+d+o,t*2),this._pos=t*2,this._finished=!0):(this.data=new ArrayBuffer(g+u+d+o),this.ids=new this.IndexArrayType(this.data,g,t),this.coords=new this.ArrayType(this.data,g+d+o,t*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(S<<4)+r]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){let i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=e,i}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return E(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:r,coords:u,nodeSize:d}=this,o=[0,r.length-1,0],a=[];for(;o.length;){let l=o.pop()||0,c=o.pop()||0,h=o.pop()||0;if(c-h<=d){for(let w=h;w<=c;w++){let m=u[2*w],x=u[2*w+1];m>=t&&m<=i&&x>=e&&x<=s&&a.push(r[w])}continue}let p=h+c>>1,f=u[2*p],y=u[2*p+1];f>=t&&f<=i&&y>=e&&y<=s&&a.push(r[p]),(l===0?t<=f:e<=y)&&(o.push(h),o.push(p-1),o.push(1-l)),(l===0?i>=f:s>=y)&&(o.push(p+1),o.push(c),o.push(1-l))}return a}within(t,e,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:s,coords:r,nodeSize:u}=this,d=[0,s.length-1,0],o=[],a=i*i;for(;d.length;){let l=d.pop()||0,c=d.pop()||0,h=d.pop()||0;if(c-h<=u){for(let w=h;w<=c;w++)z(r[2*w],r[2*w+1],t,e)<=a&&o.push(s[w]);continue}let p=h+c>>1,f=r[2*p],y=r[2*p+1];z(f,y,t,e)<=a&&o.push(s[p]),(l===0?t-i<=f:e-i<=y)&&(d.push(h),d.push(p-1),d.push(1-l)),(l===0?t+i>=f:e+i>=y)&&(d.push(p+1),d.push(c),d.push(1-l))}return o}};function E(n,t,e,i,s,r){if(s-i<=e)return;let u=i+s>>1;I(n,t,u,i,s,r),E(n,t,e,i,u-1,1-r),E(n,t,e,u+1,s,1-r)}function I(n,t,e,i,s,r){for(;s>i;){if(s-i>600){let a=s-i+1,l=e-i+1,c=Math.log(a),h=.5*Math.exp(2*c/3),p=.5*Math.sqrt(c*h*(a-h)/a)*(l-a/2<0?-1:1),f=Math.max(i,Math.floor(e-l*h/a+p)),y=Math.min(s,Math.floor(e+(a-l)*h/a+p));I(n,t,e,f,y,r)}let u=t[2*e+r],d=i,o=s;for(A(n,t,i,e),t[2*s+r]>u&&A(n,t,i,s);d<o;){for(A(n,t,d,o),d++,o--;t[2*d+r]<u;)d++;for(;t[2*o+r]>u;)o--}t[2*i+r]===u?A(n,t,i,o):(o++,A(n,t,o,s)),o<=e&&(i=o+1),e<=o&&(s=o-1)}}function A(n,t,e,i){_(n,e,i),_(t,2*e,2*i),_(t,2*e+1,2*i+1)}function _(n,t,e){let i=n[t];n[t]=n[e],n[e]=i}function z(n,t,e,i){let s=n-e,r=t-i;return s*s+r*r}var B=n=>{let t,e=new Set,i=(a,l)=>{let c=typeof a=="function"?a(t):a;if(!Object.is(c,t)){let h=t;t=l??(typeof c!="object"||c===null)?c:Object.assign({},t,c),e.forEach(p=>p(t,h))}},s=()=>t,d={setState:i,getState:s,getInitialState:()=>o,subscribe:a=>(e.add(a),()=>e.delete(a))},o=t=n(i,s,d);return d},U=n=>n?B(n):B;window.__GLOBAL_DATA_STORE__||(window.__GLOBAL_DATA_STORE__=U((n,t)=>({sites:[],currentSite:{},watersheds:[],waterbodies:[],organizations:[],states:[],counties:[],towns:[],boudaries:{},query:{},dischargeData:[],kdIndex:[],points:[],isBoundariesLoaded:!1,lang:"en",initialized:!1,setSites:e=>n(()=>({sites:e})),setCurrentSite:e=>n(()=>({currentSite:e})),setQuery:e=>n(()=>({query:e})),setStates:e=>n(()=>({states:e})),setCounties:e=>n(()=>({counties:e})),setTowns:e=>n(()=>({towns:e})),setWaterSheds:e=>n(()=>({watersheds:e})),setWaterBodies:e=>n(()=>({waterbodies:e})),setOrganizations:e=>n(()=>({organizations:e})),setBoundaries:e=>n(()=>({boudaries:e})),setIsBoundariesLoaded:e=>n(()=>({isBoundariesLoaded:e})),setLang:e=>n(()=>({lang:e})),setInitialized:e=>n(()=>({initialized:e})),setDischargeData:e=>n(()=>({dischargeData:e})),setAccessibility:e=>n(()=>({accessibility:e})),setKdIndex:e=>n(()=>({kdIndex:e})),setPoints:e=>n(()=>({points:e})),toggleAccessibility:()=>n(e=>({accessibility:!e.accessibility})),getSites:()=>t().sites,getWaterSheds:()=>t().watersheds,getWaterBodies:()=>t().waterbodies,getStates:()=>t().states,getCounties:()=>t().counties,getTowns:()=>t().towns,getOrganizations:()=>t().organizations,getBoundaries:()=>t().boudaries,getIsBoundariesLoaded:()=>t().isBoundariesLoaded,getLang:()=>t().lang,getQuery:()=>t().query,getCurrentSite:()=>t().currentSite,getInitialized:()=>t().initialized,getDischargeData:()=>t().dischargeData,getAccessibility:()=>t().accessibility,getKdIndex:()=>t().kdIndex,getPoints:()=>t().points})));var D=window.__GLOBAL_DATA_STORE__;var{setSites:C,setCurrentSite:M,setKdIndex:q,setPoints:P}=D.getState();async function L(){let n=document.querySelectorAll(".data_site"),t=document.querySelector(".data_current-site"),e=document.querySelector(".data_site-samples"),i=t.getAttribute("data-date"),s=t.getAttribute("data-quality"),r=JSON.parse(e.textContent).filter(c=>c.date),u=Array.from(new Map(r.map(c=>[new Date(c.date).getTime(),c])).values()),d={id:t.getAttribute("data-site-id"),name:t.getAttribute("data-site-name"),date:i?new Date(i):void 0,quality:s?+s:void 0,latitude:t.getAttribute("data-latitude"),longitude:t.getAttribute("data-longitude"),predictionDry:{clean:+t.getAttribute("data-clean-dry"),boating:+t.getAttribute("data-boating-dry"),notClean:+t.getAttribute("data-not-clean-dry")},predictionWet:{clean:+t.getAttribute("data-clean-wet"),boating:+t.getAttribute("data-boating-wet"),notClean:+t.getAttribute("data-not-clean-wet")},samples:u.sort((c,h)=>new Date(h.date).getTime()-new Date(c.date).getTime()),usgsId:t.getAttribute("data-usgs")},o=await N(n,d);if(!o)return!1;let a=v(o),l=F(a);C(o),P(a),q(l),console.log("Final state:"),console.log(D.getState()),R()}async function N(n,t){if(n.length<250)return!1;let e="https://is-it-clean-089e6447542b.herokuapp.com/api/v1/weathers",i=[];n.forEach(a=>{let l=a.querySelector(".site-image"),c=a.getAttribute("data-sample-date");i.push({id:a.getAttribute("data-site-id"),name:a.getAttribute("data-site-name"),latitude:a.getAttribute("data-latitude"),longitude:a.getAttribute("data-longitude"),image:l?.classList?.contains("w-dyn-bind-empty")?void 0:l?.src,quality:+a.getAttribute("data-quality"),date:c?new Date(c):void 0,predictionDry:{clean:+a.getAttribute("data-clean-dry"),boat:+a.getAttribute("data-boat-dry"),notClean:+a.getAttribute("data-not-clean-dry")},predictionWet:{clean:+a.getAttribute("data-clean-wet"),boat:+a.getAttribute("data-boat-wet"),notClean:+a.getAttribute("data-not-clean-wet")},slug:a.getAttribute("data-slug")})});let s=i.filter(a=>a.quality&&a.date),r=[...s.map(a=>a.id)];r.find(a=>a===t.id)||r.push(t.id);let d=await(await fetch(e,{method:"POST",headers:{"Content-type":"application/json; charset=UTF-8"},body:JSON.stringify({stations:r})})).json(),o=s.map(a=>({...a,wasRain:d.data.find(l=>l.id===a.id).wasRain||!1}));return M({...t,wasRain:d.data.find(a=>a.id===t.id)?.wasRain}),o}function v(n){return n.map((i,s)=>({...i,latitude:typeof i.latitude=="string"?Number(i.latitude):i.latitude,longitude:typeof i.longitude=="string"?Number(i.longitude):i.longitude,_idx:s})).map(i=>({lon:i.longitude,lat:i.latitude,idx:i._idx}))}function F(n){let t=new b(n.length,64,Float64Array);for(let e of n)t.add(e.lon,e.lat);return t.finish(),t}window.FinsweetAttributes||(window.FinsweetAttributes=[]);window.FinsweetAttributes.push(["list",async n=>{n.length>0?n.forEach(t=>{t.listElement.querySelector(".data_site")&&t.addHook("render",async()=>{await O()})}):await O()}]);async function O(){await L()}function R(){window.dataInitialized=!0,window.initQueries&&window.initQueries(),window.buildSitePage&&window.buildSitePage()}})();
