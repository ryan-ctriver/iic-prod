(()=>{var g=i=>{let t,a=new Set,s=(e,n)=>{let r=typeof e=="function"?e(t):e;if(!Object.is(r,t)){let y=t;t=n??(typeof r!="object"||r===null)?r:Object.assign({},t,r),a.forEach(p=>p(t,y))}},o=()=>t,d={setState:s,getState:o,getInitialState:()=>c,subscribe:e=>(a.add(e),()=>a.delete(e))},c=t=i(s,o,d);return d},b=i=>i?g(i):g;window.__GLOBAL_DATA_STORE__||(window.__GLOBAL_DATA_STORE__=b((i,t)=>({sites:[],currentSite:{},watersheds:[],waterbodies:[],organizations:[],states:[],counties:[],towns:[],boudaries:{},query:{},dischargeData:[],isBoundariesLoaded:!1,lang:"en",initialized:!1,setSites:a=>i(()=>({sites:a})),setCurrentSite:a=>i(()=>({currentSite:a})),setQuery:a=>i(()=>({query:a})),setStates:a=>i(()=>({states:a})),setCounties:a=>i(()=>({counties:a})),setTowns:a=>i(()=>({towns:a})),setWaterSheds:a=>i(()=>({watersheds:a})),setWaterBodies:a=>i(()=>({waterbodies:a})),setOrganizations:a=>i(()=>({organizations:a})),setBoundaries:a=>i(()=>({boudaries:a})),setIsBoundariesLoaded:a=>i(()=>({isBoundariesLoaded:a})),setLang:a=>i(()=>({lang:a})),setInitialized:a=>i(()=>({initialized:a})),setDischargeData:a=>i(()=>({dischargeData:a})),setAccessibility:a=>i(()=>({accessibility:a})),toggleAccessibility:()=>i(a=>({accessibility:!a.accessibility})),getSites:()=>t().sites,getWaterSheds:()=>t().watersheds,getWaterBodies:()=>t().waterbodies,getStates:()=>t().states,getCounties:()=>t().counties,getTowns:()=>t().towns,getOrganizations:()=>t().organizations,getBoundaries:()=>t().boudaries,getIsBoundariesLoaded:()=>t().isBoundariesLoaded,getLang:()=>t().lang,getQuery:()=>t().query,getCurrentSite:()=>t().currentSite,getInitialized:()=>t().initialized,getDischargeData:()=>t().dischargeData,getAccessibility:()=>t().accessibility})));var w=window.__GLOBAL_DATA_STORE__;var{setSites:f,getSites:T,setCurrentSite:D}=w.getState();async function S(){let i=document.querySelectorAll(".data_site"),t=document.querySelector(".data_current-site"),a=document.querySelector(".data_site-samples"),s=t.getAttribute("data-date"),o=t.getAttribute("data-quality"),u=JSON.parse(a.textContent).filter(e=>e.date),l=Array.from(new Map(u.map(e=>[new Date(e.date).getTime(),e])).values()),d={id:t.getAttribute("data-site-id"),name:t.getAttribute("data-site-name"),date:s?new Date(s):void 0,quality:o?+o:void 0,latitude:t.getAttribute("data-latitude"),longitude:t.getAttribute("data-longitude"),predictionDry:{clean:+t.getAttribute("data-clean-dry"),boating:+t.getAttribute("data-boating-dry"),notClean:+t.getAttribute("data-not-clean-dry")},predictionWet:{clean:+t.getAttribute("data-clean-wet"),boating:+t.getAttribute("data-boating-wet"),notClean:+t.getAttribute("data-not-clean-wet")},samples:l.sort((e,n)=>new Date(n.date).getTime()-new Date(e.date).getTime()),usgsId:t.getAttribute("data-usgs")},c=await h(i,d);if(!c)return!1;f(c),A()}async function h(i,t){let a="https://is-it-clean-089e6447542b.herokuapp.com/api/v1/weathers",s=[];i.forEach(e=>{let n=e.querySelector(".site-image"),r=e.getAttribute("data-sample-date");s.push({id:e.getAttribute("data-site-id"),name:e.getAttribute("data-site-name"),latitude:e.getAttribute("data-latitude"),longitude:e.getAttribute("data-longitude"),image:n?.classList?.contains("w-dyn-bind-empty")?void 0:n?.src,quality:+e.getAttribute("data-quality"),date:r?new Date(r):void 0,predictionDry:{clean:+e.getAttribute("data-clean-dry"),boat:+e.getAttribute("data-boat-dry"),notClean:+e.getAttribute("data-not-clean-dry")},predictionWet:{clean:+e.getAttribute("data-clean-wet"),boat:+e.getAttribute("data-boat-wet"),notClean:+e.getAttribute("data-not-clean-wet")},slug:e.getAttribute("data-slug")})});let o=s.filter(e=>e.quality&&e.date),u=[...o.map(e=>e.id)];u.find(e=>e===t.id)||u.push(t.id);let d=await(await fetch(a,{method:"POST",headers:{"Content-type":"application/json; charset=UTF-8"},body:JSON.stringify({stations:u})})).json(),c=o.map(e=>({...e,wasRain:d.data.find(n=>n.id===e.id).wasRain||!1}));return D({...t,wasRain:d.data.find(e=>e.id===t.id)?.wasRain}),c}async function m(){let i=await S()}m();function A(){window.dataInitialized=!0,window.initQueries&&window.initQueries(),window.buildSitePage&&window.buildSitePage()}})();
