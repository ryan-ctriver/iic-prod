<<<<<<< HEAD
(()=>{var T=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],_=1,A=8,b=class n{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[e,i]=new Uint8Array(t,0,2);if(e!==219)throw new Error("Data does not appear to be in a KDBush format.");let a=i>>4;if(a!==_)throw new Error(`Got v${a} data when expected v${_}.`);let r=T[i&15];if(!r)throw new Error("Unrecognized array type.");let[c]=new Uint16Array(t,2,1),[o]=new Uint32Array(t,4,1);return new n(o,c,r,t)}constructor(t,e=64,i=Float64Array,a){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let r=T.indexOf(this.ArrayType),c=t*2*this.ArrayType.BYTES_PER_ELEMENT,o=t*this.IndexArrayType.BYTES_PER_ELEMENT,s=(8-o%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${i}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,A,t),this.coords=new this.ArrayType(this.data,A+o+s,t*2),this._pos=t*2,this._finished=!0):(this.data=new ArrayBuffer(A+c+o+s),this.ids=new this.IndexArrayType(this.data,A,t),this.coords=new this.ArrayType(this.data,A+o+s,t*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(_<<4)+r]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){let i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=e,i}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return E(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:r,coords:c,nodeSize:o}=this,s=[0,r.length-1,0],u=[];for(;s.length;){let p=s.pop()||0,l=s.pop()||0,d=s.pop()||0;if(l-d<=o){for(let w=d;w<=l;w++){let x=c[2*w],D=c[2*w+1];x>=t&&x<=i&&D>=e&&D<=a&&u.push(r[w])}continue}let h=d+l>>1,f=c[2*h],y=c[2*h+1];f>=t&&f<=i&&y>=e&&y<=a&&u.push(r[h]),(p===0?t<=f:e<=y)&&(s.push(d),s.push(h-1),s.push(1-p)),(p===0?i>=f:a>=y)&&(s.push(h+1),s.push(l),s.push(1-p))}return u}within(t,e,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:a,coords:r,nodeSize:c}=this,o=[0,a.length-1,0],s=[],u=i*i;for(;o.length;){let p=o.pop()||0,l=o.pop()||0,d=o.pop()||0;if(l-d<=c){for(let w=d;w<=l;w++)z(r[2*w],r[2*w+1],t,e)<=u&&s.push(a[w]);continue}let h=d+l>>1,f=r[2*h],y=r[2*h+1];z(f,y,t,e)<=u&&s.push(a[h]),(p===0?t-i<=f:e-i<=y)&&(o.push(d),o.push(h-1),o.push(1-p)),(p===0?t+i>=f:e+i>=y)&&(o.push(h+1),o.push(l),o.push(1-p))}return s}};function E(n,t,e,i,a,r){if(a-i<=e)return;let c=i+a>>1;I(n,t,c,i,a,r),E(n,t,e,i,c-1,1-r),E(n,t,e,c+1,a,1-r)}function I(n,t,e,i,a,r){for(;a>i;){if(a-i>600){let u=a-i+1,p=e-i+1,l=Math.log(u),d=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*d*(u-d)/u)*(p-u/2<0?-1:1),f=Math.max(i,Math.floor(e-p*d/u+h)),y=Math.min(a,Math.floor(e+(u-p)*d/u+h));I(n,t,e,f,y,r)}let c=t[2*e+r],o=i,s=a;for(g(n,t,i,e),t[2*a+r]>c&&g(n,t,i,a);o<s;){for(g(n,t,o,s),o++,s--;t[2*o+r]<c;)o++;for(;t[2*s+r]>c;)s--}t[2*i+r]===c?g(n,t,i,s):(s++,g(n,t,s,a)),s<=e&&(i=s+1),e<=s&&(a=s-1)}}function g(n,t,e,i){m(n,e,i),m(t,2*e,2*i),m(t,2*e+1,2*i+1)}function m(n,t,e){let i=n[t];n[t]=n[e],n[e]=i}function z(n,t,e,i){let a=n-e,r=t-i;return a*a+r*r}var B=n=>{let t,e=new Set,i=(u,p)=>{let l=typeof u=="function"?u(t):u;if(!Object.is(l,t)){let d=t;t=p??(typeof l!="object"||l===null)?l:Object.assign({},t,l),e.forEach(h=>h(t,d))}},a=()=>t,o={setState:i,getState:a,getInitialState:()=>s,subscribe:u=>(e.add(u),()=>e.delete(u))},s=t=n(i,a,o);return o},U=n=>n?B(n):B;window.__GLOBAL_DATA_STORE__||(window.__GLOBAL_DATA_STORE__=U((n,t)=>({sites:[],currentSite:{},watersheds:[],waterbodies:[],organizations:[],states:[],counties:[],towns:[],boudaries:{},query:{},dischargeData:[],kdIndex:[],points:[],isBoundariesLoaded:!1,lang:"en",initialized:!1,colors:{},setSites:e=>n(()=>({sites:e})),setCurrentSite:e=>n(()=>({currentSite:e})),setQuery:e=>n(()=>({query:e})),setStates:e=>n(()=>({states:e})),setCounties:e=>n(()=>({counties:e})),setTowns:e=>n(()=>({towns:e})),setWaterSheds:e=>n(()=>({watersheds:e})),setWaterBodies:e=>n(()=>({waterbodies:e})),setOrganizations:e=>n(()=>({organizations:e})),setBoundaries:e=>n(()=>({boudaries:e})),setIsBoundariesLoaded:e=>n(()=>({isBoundariesLoaded:e})),setColors:e=>n(()=>({colors:e})),setLang:e=>n(()=>({lang:e})),setInitialized:e=>n(()=>({initialized:e})),setDischargeData:e=>n(()=>({dischargeData:e})),setAccessibility:e=>n(()=>({accessibility:e})),setKdIndex:e=>n(()=>({kdIndex:e})),setPoints:e=>n(()=>({points:e})),toggleAccessibility:()=>n(e=>({accessibility:!e.accessibility})),getSites:()=>t().sites,getWaterSheds:()=>t().watersheds,getWaterBodies:()=>t().waterbodies,getStates:()=>t().states,getCounties:()=>t().counties,getTowns:()=>t().towns,getOrganizations:()=>t().organizations,getBoundaries:()=>t().boudaries,getIsBoundariesLoaded:()=>t().isBoundariesLoaded,getColors:()=>t().colors,getLang:()=>t().lang,getQuery:()=>t().query,getCurrentSite:()=>t().currentSite,getInitialized:()=>t().initialized,getDischargeData:()=>t().dischargeData,getAccessibility:()=>t().accessibility,getKdIndex:()=>t().kdIndex,getPoints:()=>t().points})));var L=window.__GLOBAL_DATA_STORE__;var S=class extends Error{constructor(t,e){super(t),this.name="NetworkError",this.status=e}};var{setSites:q,setCurrentSite:C,setKdIndex:N,setPoints:P}=L.getState();async function O(){let n=document.querySelectorAll(".data_site"),t=document.querySelector(".data_current-site"),e=document.querySelector(".data_site-samples"),i=t.getAttribute("data-date"),a=t.getAttribute("data-quality"),r=JSON.parse(e.textContent).filter(d=>d.date),c=Array.from(new Map(r.map(d=>[new Date(d.date).getTime(),d])).values()),o="https://is-it-clean-089e6447542b.herokuapp.com/api/v1/weathers",s={id:t.getAttribute("data-site-id"),name:t.getAttribute("data-site-name"),date:i?new Date(i):void 0,quality:a?+a:void 0,latitude:t.getAttribute("data-latitude"),longitude:t.getAttribute("data-longitude"),predictionDry:{clean:+t.getAttribute("data-clean-dry"),boating:+t.getAttribute("data-boating-dry"),notClean:+t.getAttribute("data-not-clean-dry")},predictionWet:{clean:+t.getAttribute("data-clean-wet"),boating:+t.getAttribute("data-boating-wet"),notClean:+t.getAttribute("data-not-clean-wet")},samples:c.sort((d,h)=>new Date(h.date).getTime()-new Date(d.date).getTime()),usgsId:t.getAttribute("data-usgs")};try{let d=await fetch(o,{method:"POST",headers:{"Content-type":"application/json; charset=UTF-8"},body:JSON.stringify({stations:[s.id]})});if(!d.ok)throw new S("Fetch weather data is faliled");let h=await d.json();s.wasRain=h.data[0].wasRain,C({...s})}catch(d){console.error(d),C({...s,wasRain:!1})}let u=await v(n,s);if(!u)return!1;let p=F(u),l=W(p);q(u),P(p),N(l),R(),document.querySelector(".data")?.remove()}async function v(n,t){if(n.length<250)return!1;let e=[];return n.forEach(a=>{let r=a.querySelector(".site-image"),c=a.getAttribute("data-sample-date");e.push({id:a.getAttribute("data-site-id"),name:a.getAttribute("data-site-name"),latitude:a.getAttribute("data-latitude"),longitude:a.getAttribute("data-longitude"),image:r?.classList?.contains("w-dyn-bind-empty")?void 0:r?.src,quality:+a.getAttribute("data-quality"),date:c?new Date(c):void 0,predictionDry:{clean:+a.getAttribute("data-clean-dry"),boat:+a.getAttribute("data-boat-dry"),notClean:+a.getAttribute("data-not-clean-dry")},predictionWet:{clean:+a.getAttribute("data-clean-wet"),boat:+a.getAttribute("data-boat-wet"),notClean:+a.getAttribute("data-not-clean-wet")},slug:a.getAttribute("data-slug")})}),e.filter(a=>a.quality&&a.date)}function F(n){return n.map((i,a)=>({...i,latitude:typeof i.latitude=="string"?Number(i.latitude):i.latitude,longitude:typeof i.longitude=="string"?Number(i.longitude):i.longitude,_idx:a})).map(i=>({lon:i.longitude,lat:i.latitude,idx:i._idx}))}function W(n){let t=new b(n.length,64,Float64Array);for(let e of n)t.add(e.lon,e.lat);return t.finish(),t}window.FinsweetAttributes||(window.FinsweetAttributes=[]);window.FinsweetAttributes.push(["list",async n=>{n.length>0?n.forEach(t=>{t.listElement.querySelector(".data_site")&&t.addHook("render",async()=>{await M()})}):await M()}]);async function M(){await O()}function R(){window.dataInitialized=!0,window.initQueries&&window.initQueries(),window.buildSitePage&&window.buildSitePage()}})();
=======
(()=>{var T=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],_=1,A=8,b=class n{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[e,i]=new Uint8Array(t,0,2);if(e!==219)throw new Error("Data does not appear to be in a KDBush format.");let a=i>>4;if(a!==_)throw new Error(`Got v${a} data when expected v${_}.`);let r=T[i&15];if(!r)throw new Error("Unrecognized array type.");let[c]=new Uint16Array(t,2,1),[o]=new Uint32Array(t,4,1);return new n(o,c,r,t)}constructor(t,e=64,i=Float64Array,a){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let r=T.indexOf(this.ArrayType),c=t*2*this.ArrayType.BYTES_PER_ELEMENT,o=t*this.IndexArrayType.BYTES_PER_ELEMENT,s=(8-o%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${i}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,A,t),this.coords=new this.ArrayType(this.data,A+o+s,t*2),this._pos=t*2,this._finished=!0):(this.data=new ArrayBuffer(A+c+o+s),this.ids=new this.IndexArrayType(this.data,A,t),this.coords=new this.ArrayType(this.data,A+o+s,t*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(_<<4)+r]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){let i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=e,i}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return E(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:r,coords:c,nodeSize:o}=this,s=[0,r.length-1,0],u=[];for(;s.length;){let p=s.pop()||0,l=s.pop()||0,d=s.pop()||0;if(l-d<=o){for(let w=d;w<=l;w++){let x=c[2*w],D=c[2*w+1];x>=t&&x<=i&&D>=e&&D<=a&&u.push(r[w])}continue}let h=d+l>>1,f=c[2*h],y=c[2*h+1];f>=t&&f<=i&&y>=e&&y<=a&&u.push(r[h]),(p===0?t<=f:e<=y)&&(s.push(d),s.push(h-1),s.push(1-p)),(p===0?i>=f:a>=y)&&(s.push(h+1),s.push(l),s.push(1-p))}return u}within(t,e,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:a,coords:r,nodeSize:c}=this,o=[0,a.length-1,0],s=[],u=i*i;for(;o.length;){let p=o.pop()||0,l=o.pop()||0,d=o.pop()||0;if(l-d<=c){for(let w=d;w<=l;w++)z(r[2*w],r[2*w+1],t,e)<=u&&s.push(a[w]);continue}let h=d+l>>1,f=r[2*h],y=r[2*h+1];z(f,y,t,e)<=u&&s.push(a[h]),(p===0?t-i<=f:e-i<=y)&&(o.push(d),o.push(h-1),o.push(1-p)),(p===0?t+i>=f:e+i>=y)&&(o.push(h+1),o.push(l),o.push(1-p))}return s}};function E(n,t,e,i,a,r){if(a-i<=e)return;let c=i+a>>1;I(n,t,c,i,a,r),E(n,t,e,i,c-1,1-r),E(n,t,e,c+1,a,1-r)}function I(n,t,e,i,a,r){for(;a>i;){if(a-i>600){let u=a-i+1,p=e-i+1,l=Math.log(u),d=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*d*(u-d)/u)*(p-u/2<0?-1:1),f=Math.max(i,Math.floor(e-p*d/u+h)),y=Math.min(a,Math.floor(e+(u-p)*d/u+h));I(n,t,e,f,y,r)}let c=t[2*e+r],o=i,s=a;for(g(n,t,i,e),t[2*a+r]>c&&g(n,t,i,a);o<s;){for(g(n,t,o,s),o++,s--;t[2*o+r]<c;)o++;for(;t[2*s+r]>c;)s--}t[2*i+r]===c?g(n,t,i,s):(s++,g(n,t,s,a)),s<=e&&(i=s+1),e<=s&&(a=s-1)}}function g(n,t,e,i){m(n,e,i),m(t,2*e,2*i),m(t,2*e+1,2*i+1)}function m(n,t,e){let i=n[t];n[t]=n[e],n[e]=i}function z(n,t,e,i){let a=n-e,r=t-i;return a*a+r*r}var B=n=>{let t,e=new Set,i=(u,p)=>{let l=typeof u=="function"?u(t):u;if(!Object.is(l,t)){let d=t;t=p??(typeof l!="object"||l===null)?l:Object.assign({},t,l),e.forEach(h=>h(t,d))}},a=()=>t,o={setState:i,getState:a,getInitialState:()=>s,subscribe:u=>(e.add(u),()=>e.delete(u))},s=t=n(i,a,o);return o},U=n=>n?B(n):B;window.__GLOBAL_DATA_STORE__||(window.__GLOBAL_DATA_STORE__=U((n,t)=>({sites:[],currentSite:{},watersheds:[],waterbodies:[],organizations:[],states:[],counties:[],towns:[],boudaries:{},query:{},dischargeData:[],kdIndex:[],points:[],isBoundariesLoaded:!1,lang:"en",initialized:!1,setSites:e=>n(()=>({sites:e})),setCurrentSite:e=>n(()=>({currentSite:e})),setQuery:e=>n(()=>({query:e})),setStates:e=>n(()=>({states:e})),setCounties:e=>n(()=>({counties:e})),setTowns:e=>n(()=>({towns:e})),setWaterSheds:e=>n(()=>({watersheds:e})),setWaterBodies:e=>n(()=>({waterbodies:e})),setOrganizations:e=>n(()=>({organizations:e})),setBoundaries:e=>n(()=>({boudaries:e})),setIsBoundariesLoaded:e=>n(()=>({isBoundariesLoaded:e})),setLang:e=>n(()=>({lang:e})),setInitialized:e=>n(()=>({initialized:e})),setDischargeData:e=>n(()=>({dischargeData:e})),setAccessibility:e=>n(()=>({accessibility:e})),setKdIndex:e=>n(()=>({kdIndex:e})),setPoints:e=>n(()=>({points:e})),toggleAccessibility:()=>n(e=>({accessibility:!e.accessibility})),getSites:()=>t().sites,getWaterSheds:()=>t().watersheds,getWaterBodies:()=>t().waterbodies,getStates:()=>t().states,getCounties:()=>t().counties,getTowns:()=>t().towns,getOrganizations:()=>t().organizations,getBoundaries:()=>t().boudaries,getIsBoundariesLoaded:()=>t().isBoundariesLoaded,getLang:()=>t().lang,getQuery:()=>t().query,getCurrentSite:()=>t().currentSite,getInitialized:()=>t().initialized,getDischargeData:()=>t().dischargeData,getAccessibility:()=>t().accessibility,getKdIndex:()=>t().kdIndex,getPoints:()=>t().points})));var L=window.__GLOBAL_DATA_STORE__;var S=class extends Error{constructor(t,e){super(t),this.name="NetworkError",this.status=e}};var{setSites:q,setCurrentSite:O,setKdIndex:N,setPoints:P}=L.getState();async function R(){let n=document.querySelectorAll(".data_site"),t=document.querySelector(".data_current-site"),e=document.querySelector(".data_site-samples"),i=t.getAttribute("data-date"),a=t.getAttribute("data-quality"),r=JSON.parse(e.textContent).filter(d=>d.date),c=Array.from(new Map(r.map(d=>[new Date(d.date).getTime(),d])).values()),o="https://is-it-clean-089e6447542b.herokuapp.com/api/v1/weathers",s={id:t.getAttribute("data-site-id"),name:t.getAttribute("data-site-name"),date:i?new Date(i):void 0,quality:a?+a:void 0,latitude:t.getAttribute("data-latitude"),longitude:t.getAttribute("data-longitude"),predictionDry:{clean:+t.getAttribute("data-clean-dry"),boating:+t.getAttribute("data-boating-dry"),notClean:+t.getAttribute("data-not-clean-dry")},predictionWet:{clean:+t.getAttribute("data-clean-wet"),boating:+t.getAttribute("data-boating-wet"),notClean:+t.getAttribute("data-not-clean-wet")},samples:c.sort((d,h)=>new Date(h.date).getTime()-new Date(d.date).getTime()),usgsId:t.getAttribute("data-usgs")};try{let d=await fetch(o,{method:"POST",headers:{"Content-type":"application/json; charset=UTF-8"},body:JSON.stringify({stations:[s.id]})});if(!d.ok)throw new S("Fetch weather data is faliled");let h=await d.json();s.wasRain=h.data[0].wasRain,O({...s})}catch(d){console.error(d),O({...s,wasRain:!1})}let u=await v(n,s);if(!u)return!1;let p=F(u),l=W(p);q(u),P(p),N(l),C(),document.querySelector(".data")?.remove()}async function v(n,t){if(n.length<250)return!1;let e=[];return n.forEach(a=>{let r=a.querySelector(".site-image"),c=a.getAttribute("data-sample-date");e.push({id:a.getAttribute("data-site-id"),name:a.getAttribute("data-site-name"),latitude:a.getAttribute("data-latitude"),longitude:a.getAttribute("data-longitude"),image:r?.classList?.contains("w-dyn-bind-empty")?void 0:r?.src,quality:+a.getAttribute("data-quality"),date:c?new Date(c):void 0,predictionDry:{clean:+a.getAttribute("data-clean-dry"),boat:+a.getAttribute("data-boat-dry"),notClean:+a.getAttribute("data-not-clean-dry")},predictionWet:{clean:+a.getAttribute("data-clean-wet"),boat:+a.getAttribute("data-boat-wet"),notClean:+a.getAttribute("data-not-clean-wet")},slug:a.getAttribute("data-slug")})}),e.filter(a=>a.quality&&a.date)}function F(n){return n.map((i,a)=>({...i,latitude:typeof i.latitude=="string"?Number(i.latitude):i.latitude,longitude:typeof i.longitude=="string"?Number(i.longitude):i.longitude,_idx:a})).map(i=>({lon:i.longitude,lat:i.latitude,idx:i._idx}))}function W(n){let t=new b(n.length,64,Float64Array);for(let e of n)t.add(e.lon,e.lat);return t.finish(),t}window.FinsweetAttributes||(window.FinsweetAttributes=[]);window.FinsweetAttributes.push(["list",async n=>{n.length>0?n.forEach(t=>{t.listElement.querySelector(".data_site")&&t.addHook("render",async()=>{await M()})}):await M()}]);async function M(){await R()}function C(){window.dataInitialized=!0,window.initQueries&&window.initQueries(),window.buildSitePage&&window.buildSitePage()}})();
>>>>>>> a526947f4e024d155ff980808ddb8c37daf4d8a2
